# 协议实现状态检测报告

## 一、未实现的协议（已补全）

以下 CMD 在 Lua 游戏服 `gamepktprotocol.lua` 的 **emptyCmds** 中统一回空包，此前 Go 未注册，会触发「未实现的命令」并走默认空包。**已全部补注册为 handleStubEmpty**，不再落入默认分支：

| CMD | 说明（Lua 侧） |
|-----|----------------|
| 5003 | LEAVE_GAME |
| 1011, 1016 | 会话/协议相关 |
| 2289, 2192, 2196 | 任务/活动相关 |
| 2361 | 精灵相关（2313 已在 stub4Zero） |
| 3405, 4359, 4364, 4501, 5005, 9112, 9677 | 各类功能空响应 |
| 41006, 41249, 41253, 4148, 4178, 4181, 43706 | 活动/数值相关 |
| 45512, 45524, 45773, 45793, 45798, 45824, 47309, 45071 | 扩展协议 |
| 40006, 40007 | 超级数值相关 |

**说明**：9003 (NonoInfo)、2354 (GetSoulBeadList) 在 Go 中已有完整实现，未放入 stub。

---

## 二、当前仍「返回空包」的协议（handleStubEmpty）

仅返回 **result=0、body 长度 0** 的 CMD，用于占位，避免客户端报错：

| CMD | 说明 |
|-----|------|
| 5003 | LEAVE_GAME（离开游戏） |
| 1011, 1016, 2289, 2192, 2196, 2361, 3405, 4359, 4364, 4501, 5005, 9112, 9677 | 见上表 |
| 41006, 41249, 41253, 4148, 4178, 4181, 43706, 45512, 45524, 45773, 45793, 45798, 45824, 47309, 45071, 40006, 40007 | 见上表 |

---

## 三、当前「最小协议体」占位（非空包但无业务逻辑）

### 1. handleStub4Zero（4 字节 0）

小游戏、精灵高级、竞技场、战队、师徒、战队 PK、房间、好友等，Lua 侧多为 `writeUInt32BE(0)`，Go 用 **handleStub4Zero** 回 4 字节 0：

- **小游戏**：5001, 5002, 3201, 9757, 2442, 2444, 2445, 2446  
- **精灵高级**：2328（Skill_Sort，客户端未使用，仍保持 4 字节 0 占位；原列出的 2302, 2306–2316, 2320–2324, 2327, 2329–2332, 2343, 2351–2353, 2356–2358 已在 Go 中实现完整协议体，见下节）  
- **特殊**：2393  
- **竞技场**：2417–2426；**勇者之塔**：2414–2416 已完整实现；**试炼之塔**：2428–2430  
- **战队**：2910–2914, 2917, 2918, 2928, 2929, 2962, 2963  
- **师徒**：3001–3011  
- **战队 PK**：4001–4014, 4017–4025, 4101, 4102, 2481  
- **房间/基地**：10001–10005, 10007–10009  
- **好友**：2151–2155, 2157–2159  

### 2. handleStub8Zero（8 字节 0）

- **5052** FB_GAME_OVER（Lua 为 ret(4)+count(4)）

---

## 四、已实现完整协议或业务逻辑的 CMD（非空包/非占位）

以下为已有**完整协议体或业务逻辑**的 CMD（非 handleStub* 占位）：

- 登录/系统：1001, 1002, 1004, 1005, 10006, 1101, 1102, 1103, 1104, 1105, 1106, 80008  
- 协议层：1022, 8002, 9049, 11003, 11007, 11022, 41983, 46046, 40001, 40002, 42023, 46057, 41080, 47334, 47335, 10301, 4475, 8001, 8004  
- 地图/玩家：2001–2004, 2051, 2052, 2061, 2063, 2101–2104, 2111, 2112  
- 任务：2201–2204, 2231–2234；2235 ADD_DAILY_TASK_BUF 已注册为 4 字节 0 占位  
- 交换：2065, 2251, 2701, 2702, 2901, 2902  
- 精灵/战斗：2301–2307, 2309–2312, 2314–2316, 2318, 2319, 2320–2327, 2329–2332, 2325, 2336, 2343, 2351–2354, 2356–2358, 2404–2412, 2414–2416（勇者之塔）, 9278  
- 物品：2601, 2602, 2604–2607, 2609  
- 邮件/好友：2150, 2751, 2757  
- 其他：50004, 50008, 70001  
- NONO：9001–9027, 80001  

---

## 五、结论

1. **未实现协议**：Lua `emptyCmds` 中的 CMD 已在 Go 中全部注册为 **handleStubEmpty**，不再出现「未实现的命令」日志。  
2. **返回空包**：仅上述「二」中的 CMD 为纯空包；其余需占位响应的已用 4/8 字节 0 或完整协议体处理。  
3. **后续可做**：若需与 Lua 行为完全一致，可针对「二」「三」中的 CMD 按 Lua 响应格式逐条实现具体 body 与逻辑。
